var egret=window.egret,__reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(a,s){function r(t){try{h(n.next(t))}catch(e){s(e)}}function o(t){try{h(n["throw"](t))}catch(e){s(e)}}function h(t){t.done?a(t.value):new i(function(e){e(t.value)}).then(r,o)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(a)throw new TypeError("Generator is already executing.");for(;h;)try{if(a=1,s&&(r=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(s,i[1])).done)return r;switch(s=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,s=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(r=h.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){h.label=i[1];break}if(6===i[0]&&h.label<r[1]){h.label=r[1],r=i;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(i);break}r[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],s=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var a,s,r,o,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},GameEndPanel=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.start=function(){var t=this,e=t.restartBtn,i=t.onTouchTap;e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,i,this)},e.prototype.init=function(){this.restartBtn=new egret.TextField,this.restartBtn.text="重新开始",this.restartBtn.x=225-this.restartBtn.width,this.restartBtn.y=400,this.addChild(this.restartBtn)},e.prototype.onTouchTap=function(){this.dispatchEventWith(e.GAME_RESTART)},e.prototype.end=function(){var t=this,e=t.restartBtn,i=t.onTouchTap;e.$touchEnabled=!1,e.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&e.removeEventListener(egret.TouchEvent.TOUCH_TAP,i,this)},e.GAME_RESTART="gamerestart",e}(egret.Sprite);__reflect(GameEndPanel.prototype,"GameEndPanel");var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),platform.openDataContext.postMessage({command:"loadRes"}),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){platform.scopeUserInfo();var t=this.stage,e=new egret.Shape;e.graphics.beginGradientFill(egret.GradientType.RADIAL,[16178084,16576726],[1,1],[150,50],new egret.Matrix),e.graphics.drawRect(0,0,t.stageWidth,t.stageHeight),e.graphics.endFill(),this.addChild(e),this.init()},e.prototype.init=function(){this.gameStartPanel=new GameStartPanel,this.gamePlayingPanel=new GamePlayingPanel,this.gameEndPanel=new GameEndPanel,this.start()},e.prototype.start=function(){this.addChild(this.gameStartPanel),this.gameStartPanel.start(),this.gameStartPanel.addEventListener(GameStartPanel.GAME_START_1,this.gamePlaying1,this),this.gameStartPanel.addEventListener(GameStartPanel.GAME_START_2,this.gamePlaying2,this)},e.prototype.gamePlaying1=function(){this.gameStartPanel.end(),this.removeChild(this.gameStartPanel),this.gameStartPanel.removeEventListener(GameStartPanel.GAME_START_1,this.gamePlaying1,this),this.gameStartPanel.removeEventListener(GameStartPanel.GAME_START_2,this.gamePlaying2,this),this.addChild(this.gamePlayingPanel),this.gamePlayingPanel.start(1),this.gamePlayingPanel.addEventListener(GamePlayingPanel.GAME_END,this.gameEnd,this),this.gamePlayingPanel.addEventListener(GamePlayingPanel.GAME_RESTART,this.gameRestart,this)},e.prototype.gamePlaying2=function(){this.gameStartPanel.end(),this.removeChild(this.gameStartPanel),this.gameStartPanel.removeEventListener(GameStartPanel.GAME_START_1,this.gamePlaying1,this),this.gameStartPanel.removeEventListener(GameStartPanel.GAME_START_2,this.gamePlaying2,this),this.addChild(this.gamePlayingPanel),this.gamePlayingPanel.start(2),this.gamePlayingPanel.addEventListener(GamePlayingPanel.GAME_END,this.gameEnd,this),this.gamePlayingPanel.addEventListener(GamePlayingPanel.GAME_RESTART,this.gameRestart,this)},e.prototype.gameEnd=function(){this.gamePlayingPanel.end(),this.removeChild(this.gamePlayingPanel),this.gamePlayingPanel.removeEventListener(GamePlayingPanel.GAME_END,this.gameEnd,this),this.gamePlayingPanel.removeEventListener(GamePlayingPanel.GAME_RESTART,this.gameRestart,this),this.start()},e.prototype.gameRestart=function(){},e}(eui.UILayer);__reflect(Main.prototype,"Main");var Buttons=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(t,e,i,n,a){var s=this;void 0===t&&(t=1),void 0===i&&(i=24),void 0===n&&(n=180),void 0===a&&(a=64),this.img=new egret.Bitmap,this.txt=new egret.TextField,this.width=n,this.height=a,1===t?(this.img.texture=RES.getRes("btn_bg_green_png"),this.txt.strokeColor=4367877):2===t?(this.img.texture=RES.getRes("btn_bg_blue_png"),this.txt.strokeColor=2458307):3===t?(this.img.texture=RES.getRes("btn_bg_purple_png"),this.txt.strokeColor=8458165):4===t?(this.img.texture=RES.getRes("btn_bg_pink_png"),this.txt.strokeColor=12781621):5===t?(this.img.texture=RES.getRes("btn_bg_brown_png"),this.txt.strokeColor=9324838):(this.img.texture=RES.getRes("btn_bg_grey_png"),this.txt.strokeColor=6645093),this.img.scale9Grid=new egret.Rectangle(10,10,14,103),this.img.width=n,this.img.height=a,this.addChild(this.img),this.txt.size=i,this.txt.textColor=16777215,this.txt.text=e,this.txt.stroke=1,this.txt.x=this.img.width/2-this.txt.width/2,this.txt.y=this.img.height/2-this.txt.height/2,this.addChild(this.txt),this.img.touchEnabled=!0,this.img.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){s.img.x=s.img.x+2,s.img.y=s.img.y+2,s.txt.x=s.txt.x+2,s.txt.y=s.txt.y+2},this),this.img.addEventListener(egret.TouchEvent.TOUCH_END,function(){s.img.x=s.img.x-2,s.img.y=s.img.y-2,s.txt.x=s.txt.x-2,s.txt.y=s.txt.y-2},this),this.img.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){s.img.x=s.img.x-2,s.img.y=s.img.y-2,s.txt.x=s.txt.x-2,s.txt.y=s.txt.y-2},this)},e}(egret.Sprite);__reflect(Buttons.prototype,"Buttons");var Dialog=function(t){function e(){var e=t.call(this)||this;return e._width=280,e._height=400,e.GAME_RESTART="gamerestart",e.GAME_SHARE="gameshare",e.GAME_AD="gamead",e.init(),e}return __extends(e,t),e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t,i,n,a,s,r,o,h,l,g,d,u,c=this;return __generator(this,function(p){switch(p.label){case 0:return t=this,i=t.maskBlack,n=t.tip,a=t.homeBtn,s=t.restartBtn,r=t.shareBtn,o=t.adBtn,i=new egret.Shape,i.graphics.beginFill(0,.8),i.graphics.drawRoundRect(0,0,this._width,this._height,10),this.addChild(i),n=new egret.TextField,n.y=15,n.text="本次得分",n.textColor=16777215,n.size=18,n.x=this._width/2-n.width/2,this.addChild(n),a=new Buttons,a.init(3,"回到首页"),a.scaleX=.5,a.scaleY=.5,this.addChild(a),a.x=30,a.y=300,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.dispatchEventWith(e.GO_HOME)},this),s=new Buttons,s.init(1,"再玩一次"),this.addChild(s),s.x=160,s.y=300,s.scaleX=.5,s.scaleY=.5,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.dispatchEventWith(e.RESTART)},this),r=new Buttons,r.init(2,"炫耀战绩"),this.addChild(r),r.x=30,r.y=350,r.scaleX=.5,r.scaleY=.5,r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){platform.share()},this),o=new Buttons,o.init(4,"免费复活"),this.addChild(o),o.x=160,o.y=350,o.scaleX=.5,o.scaleY=.5,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=new Date,i=""+t.getFullYear()+t.getMonth()+t.getDate(),n=c;platform.getData(i,function(t){if(t&&t.data){if(t.data){var a=t.data;a+=1,3>=a?(n.dispatchEventWith(e.REBIRTH),platform.setData({key:i,value:a})):n.dispatchEventWith(e.NOCHANCE)}}else n.dispatchEventWith(e.REBIRTH),platform.setData({key:i,value:1})})},this),this.scores=new egret.TextField,this.scores.text="0",this.scores.textAlign=egret.HorizontalAlign.CENTER,this.scores.size=22,this.scores.textColor=16777215,this.scores.y=40,this.scores.x=this._width/2-this.scores.width/2,this.addChild(this.scores),[4,platform.getUserInfo()];case 1:return h=p.sent(),console.log(111,h),l=this,g=h.avatarUrl,d=new egret.ImageLoader,d.crossOrigin="",d.load(g),d.once(egret.Event.COMPLETE,function(t){if(t.currentTarget.data){var e=new egret.Texture;e.bitmapData=t.currentTarget.data;var i=new egret.Bitmap(e);i.width=100,i.height=100,l.addChild(i),i.x=l._width/2-i.width/2,i.y=100}},this),u=new egret.TextField,u.size=14,u.textColor=16777215,u.text=h.nickName,u.x=this._width/2-u.width/2,u.y=220,this.addChild(u),[2]}})})},e.prototype.setScores=function(t){this.scores.text=""+t,this.scores.x=this._width/2-this.scores.width/2},e.GO_HOME="gohome",e.RESTART="restart",e.SHARE_WX="sharewx",e.VIEW_AD="viewad",e.REBIRTH="rebirth",e.NOCHANCE="nochance",e}(egret.Sprite);__reflect(Dialog.prototype,"Dialog");var Msg=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(t){var e=this,i=egret.MainContext.instance.stage,n=new egret.Shape;n.graphics.beginFill(0,.6),n.graphics.drawRect(0,-100,i.stageWidth,100),n.graphics.endFill(),this.addChild(n),egret.Tween.get(n).to({y:100},100,egret.Ease.bounceOut).call(function(){setTimeout(function(){e.removeChild(n)},3e3)},this);var a=new egret.TextField;a.size=14,a.textColor=16777215,a.text=t,a.x=i.stageWidth/2-a.width/2,a.y=-50-a.height/2,this.addChild(a),egret.Tween.get(a).to({y:50-a.height/2},100,egret.Ease.bounceOut).call(function(){setTimeout(function(){e.removeChild(a)},3e3)},this)},e}(egret.Sprite);__reflect(Msg.prototype,"Msg");var SkinDialog=function(t){function e(){var e=t.call(this)||this;return e._width=300,e._height=400,e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=this,i=new egret.Shape;i.graphics.beginFill(0,.8),i.graphics.drawRoundRect(0,0,this._width,this._height,10),i.graphics.endFill(),this.addChild(i);var n=new egret.Bitmap(RES.getRes("close_png"));n.width=25,n.height=25,n.x=this._width-13,n.y=-13,this.addChild(n),n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.dispatchEventWith(e.CLOSE_SKIN)},this);var a=new egret.TextField;a.textColor=16777215,a.size=24,a.text="皮肤选择",a.x=this._width/2-a.width/2,a.y=20,this.addChild(a);var s=[{text:"默认皮肤",value:1},{text:"无限月读",value:2}];s.forEach(function(i,n){var a=new egret.TextField;a.textColor=16777215,a.size=16,a.y=40*n+70,a.x=20,a.text=i.text,a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){platform.setData({key:"skin",value:i.value}),t.dispatchEventWith(e.CLOSE_SKIN)},t),t.addChild(a)})},e.CLOSE_SKIN="closeskin",e}(egret.Sprite);__reflect(SkinDialog.prototype,"SkinDialog");var TimberMask=function(t){function e(){var e=t.call(this)||this;return e.ary=[],e}return __extends(e,t),e.prototype.init=function(t){var e=[0,360];e.push(Tools.generateRandom(10,350)),e.push(Tools.generateRandom(10,350)),e.push(Tools.generateRandom(10,350)),e.sort(function(t,e){return t-e});for(var i=0;i<e.length-1;i++){var n=100,a=i+1,s=e[i],r=a>e.length?360:e[a],o=new TimberMaskSprite;o.createMask(n,s,r,t),this.addChild(o),this.ary.push(o)}},e.prototype.startAnimation=function(){var t=this,e=egret.MainContext.instance.stage;this.ary.forEach(function(i){i.rotation=Tools.generateRandom(30,90),i.x=i.x+Tools.generateRandom(30,90),i.y=i.y+Tools.generateRandom(30,90),egret.Tween.get(i).to({rotation:Tools.generateRandom(30,90),y:e.stageHeight,x:Tools.generateRandom(2*-e.stageWidth,2*e.stageWidth)},1e3).call(function(){i.parent.removeChild(i)},t)})},e}(egret.Sprite);__reflect(TimberMask.prototype,"TimberMask");var TimberMaskSprite=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createMask=function(t,e,i,n){var a=1===n?"timber_png":"eye_png",s=new egret.Bitmap(RES.getRes(a));s.width=2*t,s.height=2*t,this.addChild(s);var r=new egret.Shape;r.graphics.beginFill(0),r.graphics.moveTo(t,t),r.graphics.lineTo(2*t,t),r.graphics.drawArc(t,t,t,e*Math.PI/180,i*Math.PI/180),r.graphics.lineTo(t,t),r.graphics.endFill(),this.addChild(r),s.mask=r},e}(egret.Sprite);__reflect(TimberMaskSprite.prototype,"TimberMaskSprite");var Bottom=function(t){function e(){var e=t.call(this)||this;return e.height=100,e._width=1e3,e}return __extends(e,t),e.prototype.init=function(){var t=this,i=new egret.Shape;i.graphics.beginFill(0,.5),i.graphics.drawRect(0,0,this._width,this.height),i.graphics.endFill(),this.bg=i,this.addChild(this.bg);var n=new egret.Bitmap;n.texture=RES.getRes("b1_png"),n.width=26.5,n.height=26,n.x=30,n.y=20,this.addChild(n),n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.dispatchEventWith(e.FRIENDS_RANK)},this);var a=new egret.TextField;a.text="好友排行",a.size=12,a.textColor=16777215,a.x=20,a.y=60,this.addChild(a),a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.dispatchEventWith(e.FRIENDS_RANK)},this);var s=new egret.Bitmap;s.texture=RES.getRes("b2_png"),s.width=23.5,s.height=23,s.x=130,s.y=20,this.addChild(s),s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.dispatchEventWith(e.FRIENDS_RANK)},this);var r=new egret.TextField;r.text="群内排行",r.size=12,r.textColor=16777215,r.x=120,r.y=60,this.addChild(r),r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.dispatchEventWith(e.FRIENDS_RANK)},this);var o=new egret.Bitmap;o.texture=RES.getRes("b4_png"),o.width=30,o.height=24,o.x=230,o.y=20,this.addChild(o),o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.dispatchEventWith(e.SKIN)},this);var h=new egret.TextField;h.text="皮肤",h.size=12,h.textColor=16777215,h.x=235,h.y=60,this.addChild(h),h.touchEnabled=!0,h.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.dispatchEventWith(e.SKIN)},this);var l={appId:"wx18a2ac992306a5a4",path:"pages/apps/largess/detail?id=waQKNtmC5mk%3D"},g=new egret.Bitmap;g.texture=RES.getRes("like_png"),g.width=28,g.height=26,g.x=330,g.y=20,this.addChild(g),g.touchEnabled=!0,g.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.dispatchEventWith(e.ZAN),platform.openMini(l)},this);var d=new egret.TextField;d.text="给攒",d.size=12,d.textColor=16777215,d.x=331,d.y=60,this.addChild(d),d.touchEnabled=!0,d.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.dispatchEventWith(e.ZAN),platform.openMini(l)},this)},e.FRIENDS_RANK="friendsrank",e.GROUP_RANK="grouprank",e.WORLD_RANK="worldrank",e.SKIN="skin",e.ZAN="ZAN",e}(egret.Sprite);__reflect(Bottom.prototype,"Bottom");var GamePlayingPanel=function(t){function e(){var e=t.call(this)||this;return e.mode=1,e.skin=1,e.rotations=3,e.isShooting=!1,e.insertRotate=[],e.insertRotateNoAnimate=[],e.kunaiW=21,e.kunaiH=100,e.rate=35,e.rateOffset=0,e.kunaiNum=9,e.level=1,e.calcCollision=function(t){var i=e.insertRotate;return i.some(function(e){return t<=e.range[1]&&t>=e.range[0]})},e.initGame(),e}return __extends(e,t),e.prototype.start=function(t){this.mode=t;var e;1===this.mode?e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]:2===this.mode&&(e=[-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]);var i=new egret.ColorMatrixFilter(e);this.bgimg.filters=[i]},e.prototype.end=function(){this.resetGame()},e.prototype.initGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,n;return __generator(this,function(a){switch(a.label){case 0:return t=egret.MainContext.instance.stage,e=t.stageWidth,i=t.stageHeight,this.bgimg=new egret.Bitmap,this.bgimg.x=0,this.bgimg.y=0,this.bgimg.width=e,this.bgimg.height=i,this.addChild(this.bgimg),[4,platform.getData("skin")];case 1:return n=a.sent()||1,this.skin=parseInt(n),1===this.skin?(this.bgimg.texture=RES.getRes("4_jpg"),this.bgimg.alpha=.4,this.timber=this.createBitmapByName("timber_png"),this.addChild(this.timber),this.timber.width=200,this.timber.height=200):2===this.skin&&(this.bgimg.texture=RES.getRes("2_jpg"),this.bgimg.alpha=.7,this.timber=this.createBitmapByName("eye_png"),this.addChild(this.timber),this.timber.width=280,this.timber.height=280),this.timber.anchorOffsetX=this.timber.width/2,this.timber.anchorOffsetY=this.timber.height/2,this.timber.x=e/2,this.timber.y=230,this.layerNum=this.numChildren,this.createText(),this.createKunai(),this.createKunaiNum(),this.createScores(),this.share(),[2]}})})},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.startAnimation=function(){var t=this;this.timberInterval&&clearInterval(this.timberInterval),this.timber.rotation=0,this.timberInterval=setInterval(function(){t.timber.rotation+=t.rotations},this.rate-this.rateOffset)},e.prototype.resetAnimation=function(){var t=this;if(1===this.mode){var e=Math.floor(Math.random()*this.level);this.rateOffset=Math.random()<.2?e:-1*e,this.rotations=this.level%3===0&&Math.random()<.1?-1*this.rotations:this.rotations}else 2===this.mode&&(this.rateOffset=1.2*this.level);this.timberInterval&&clearInterval(this.timberInterval),this.timberInterval=setInterval(function(){t.timber.rotation+=t.rotations},this.rate-this.rateOffset),this.resetRotateKunai()},e.prototype.shoot=function(t){var e=this;if(!(this.isShooting||this.kunaiNum<=0)){this.isShooting=!0,this.kunaiNum-=1,this.updateKunaiNum();var i=function(){if(e.calcCollision(e.timber.rotation))e.flickKunai();else{e.woodBits();var t=e.timber.x,i=e.timber.y;egret.Tween.get(e.timber).to({x:e.timber.x-6,y:e.timber.y-7},20,egret.Ease.bounceInOut).to({x:t,y:i},20,egret.Ease.bounceInOut).call(function(){e.kunaiNum<=0?e.showNext():e.resetKunai(),e.resetAnimation()},e),e.kunai.alpha=0,e.createRotateKunai(),e.updateScores()}};egret.Tween.get(this.kunai).to({y:380},150,egret.Ease.cubicIn).call(i,this)}},e.prototype.createClickable=function(){var t=egret.MainContext.instance.stage,e=new egret.Shape;e.graphics.beginFill(0,0),e.graphics.drawRect(0,t.stageHeight-200,t.stageWidth,300),e.graphics.endFill(),this.addChild(e),e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.shoot,this)},e.prototype.createKunai=function(){var t=egret.MainContext.instance.stage;this.kunai=this.createBitmapByName("kunai_png"),this.addChild(this.kunai);var e=t.stageWidth,i=t.stageHeight;this.kunai.width=this.kunaiW,this.kunai.height=this.kunaiH,this.kunai.x=e/2-10,this.kunai.y=i-170,this.createRandomKunai(),this.createClickable()},e.prototype.resetKunai=function(){var t=egret.MainContext.instance.stage,e=t.stageWidth,i=t.stageHeight;this.kunai.width=20,this.kunai.height=100,this.kunai.rotation=0,this.kunai.x=e/2-10,this.kunai.y=i-170,this.kunai.alpha=1,this.isShooting=!1},e.prototype.createRotateKunai=function(t){var e=this,i=egret.MainContext.instance.stage,n="number"==typeof t?t:this.timber.rotation,a=[];a.push(n-10),a.push(n+10);var s=this.createBitmapByName("kunai_png");s.anchorOffsetX=5,s.anchorOffsetY=-52,s.x=i.stageWidth/2,s.y=230,s.width=this.kunaiW,s.height=this.kunaiH,s.rotation="number"==typeof t?-t:0,this.addChildAt(s,this.layerNum-1);var r=setInterval(function(){s.rotation+=e.rotations},this.rate-this.rateOffset),o={id:this.timber.rotation,range:a,kunai:s,time:r};this.insertRotate.push(o)},e.prototype.createRotateKunaiNoAnimate=function(t){var e=egret.MainContext.instance.stage,i=this.createBitmapByName("kunai_png");i.anchorOffsetX=5,i.anchorOffsetY=-52,i.x=e.stageWidth/2,i.y=230,i.width=this.kunaiW,i.height=this.kunaiH,i.rotation=-t,this.addChildAt(i,this.layerNum-1),this.insertRotateNoAnimate.push(i)},e.prototype.resetRotateKunai=function(){var t=this;this.insertRotate.forEach(function(e){e.time&&clearInterval(e.time);var i=setInterval(function(){e.kunai.rotation+=t.rotations},t.rate-t.rateOffset);e.time=i})},e.prototype.removeRotateKunai=function(t){void 0===t&&(t=3);for(var e=function(t){var e=i.insertRotate.splice(0,1)[0];e&&e.kunai&&egret.Tween.get(e.kunai).to({alpha:0},100).call(function(){e.kunai.parent.removeChild(e.kunai)},i)},i=this,n=0;t>n;n++)e(n)},e.prototype.flickKunai=function(){var t=this,e=egret.MainContext.instance.stage,i=function(){setTimeout(function(){t.showDialog()},500)};egret.Tween.get(this.kunai).to({x:e.stageWidth+100,y:e.stageHeight+100,rotation:720},700,egret.Ease.bounceOut).call(i,this)},e.prototype.createText=function(){var t=(egret.MainContext.instance.stage,new egret.Shape);t.graphics.beginFill(3086352,.8),t.graphics.drawRoundRect(-10,10,80,30,10),t.graphics.endFill(),this.addChild(t),this.textfield=new egret.TextField,this.addChild(this.textfield),this.textfield.x=12,this.textfield.y=17,this.textfield.textColor=16777215,this.textfield.textAlign=egret.HorizontalAlign.CENTER,this.textfield.size=14,this.updateLevel()},e.prototype.updateLevel=function(){this.textfield.text="第 "+this.level+" 关"},e.prototype.createKunaiNum=function(){var t=egret.MainContext.instance.stage,e=this.createBitmapByName("kunai_png");e.width=10,e.height=50,e.x=30,e.y=t.stageHeight-100,this.addChild(e),this.kunaiNumTips=new egret.TextField,this.addChild(this.kunaiNumTips),this.kunaiNumTips.x=50,this.kunaiNumTips.y=t.stageHeight-80,this.kunaiNumTips.textColor=16777215,this.kunaiNumTips.textAlign=egret.HorizontalAlign.LEFT,this.kunaiNumTips.size=14,this.updateKunaiNum()},e.prototype.updateKunaiNum=function(){this.kunaiNumTips.text="x "+this.kunaiNum},e.prototype.createScores=function(){var t=egret.MainContext.instance.stage,e=new egret.Shape;e.graphics.beginFill(16777215,.8),e.graphics.drawRoundRect(t.stageWidth/2-50,10,100,60,10),e.graphics.endFill(),this.addChild(e);var i=new egret.TextField;i.size=18,i.textColor=0,i.text="得分",i.x=t.stageWidth/2-i.width/2,i.y=20,this.addChild(i),this.scores=new egret.TextField,this.scores.size=16,this.scores.textColor=0,this.scores.text="0",this.scores.x=t.stageWidth/2-this.scores.width/2,this.scores.y=45,this.addChild(this.scores)},e.prototype.updateScores=function(t){var e=egret.MainContext.instance.stage;this.scores.text="number"==typeof t?""+t:""+(parseInt(this.scores.text)+1),this.scores.x=e.stageWidth/2-this.scores.width/2},e.prototype.showNext=function(){var t=this;this.timber.alpha=0,this.masks(),this.timberMask.startAnimation();var e=[];this.insertRotate.forEach(function(t){t.time&&clearInterval(t.time),t.kunai.parent.removeChild(t.kunai),e.push(t.id)}),this.insertRotate=[],e.forEach(function(e){t.createRotateKunaiNoAnimate(e)}),this.insertRotateNoAnimate.forEach(function(e){e.rotation=Tools.generateRandom(-180,180),egret.Tween.get(e).to({x:Tools.generateRandom(-t.stage.stageWidth,t.stage.stageWidth),y:t.stage.stageHeight+2*e.height},1e3)}),setTimeout(function(){t.timber.alpha=1,t.goNext()},1100)},e.prototype.goNext=function(){this.level+=1,this.kunaiNum=9+Math.floor(this.level/10-1),this.kunaiNum<=0&&(this.kunaiNum=1),this.cleanBitmap(),this.createRandomKunai(),this.updateKunaiNum(),this.updateLevel(),this.resetKunai()},e.prototype.createRandomKunai=function(){if(1!==this.level)if(1===this.mode){var t=Math.floor(Math.random()*this.level);t>=this.level/2&&(this.kunaiNum=this.kunaiNum-Math.floor(Math.random()*this.level/2+1));for(var e=1;t>e;e++){var i=Math.floor(180*Math.random());i=Math.random()<.5?-1*i:i,this.createRotateKunai(i)}}else if(2===this.mode)for(var e=1;e<this.level;e++){var t=Math.floor(180*Math.random());t=Math.random()<.5?-1*t:t,this.createRotateKunai(t)}this.startAnimation()},e.prototype.showDialog=function(){return __awaiter(this,void 0,void 0,function(){var t,i,n=this;return __generator(this,function(a){return t=egret.MainContext.instance.stage,this.dialog=new Dialog,this.dialog.setScores(this.scores.text),this.addChild(this.dialog),this.dialog.x=t.stageWidth/2-this.dialog._width/2,this.dialog.y=t.stageHeight/2-this.dialog._height/2,this.dialog.addEventListener(Dialog.GO_HOME,function(){n.dispatchEventWith(e.GAME_END)},this),this.dialog.addEventListener(Dialog.RESTART,function(){n.resetGame()},this),this.dialog.addEventListener(Dialog.REBIRTH,function(){n.rebirth()},this),this.dialog.addEventListener(Dialog.NOCHANCE,function(){n.noChance()},this),i={key:"score",value:this.scores.text},platform.setUserCloudStorage(i),[2]})})},e.prototype.closeDialog=function(){var t=this;this.removeChild(this.dialog),this.dialog.removeEventListener(Dialog.GO_HOME,function(){t.dispatchEventWith(e.GAME_END)},this),this.dialog.removeEventListener(Dialog.RESTART,function(){t.resetGame()},this),this.dialog.removeEventListener(Dialog.REBIRTH,function(){t.rebirth()},this)},e.prototype.resetGame=function(){this.closeDialog(),this.level=1,this.kunaiNum=9,this.cleanBitmap(),this.createRandomKunai(),this.updateKunaiNum(),this.updateLevel(),this.resetKunai(),this.updateScores(0)},e.prototype.cleanBitmap=function(){this.insertRotate.forEach(function(t){t.kunai.parent.removeChild(t.kunai)}),this.insertRotate=[]},e.prototype.woodBits=function(){for(var t=this,e=egret.MainContext.instance.stage,i=e.stageWidth,n=e.stageHeight,a=function(e){var a=s.createBitmapByName("dou_png");a.width=5,a.height=5,a.x=i/2-1,a.y=290,s.addChild(a);var r=Math.floor(Math.random()*i*2);r=Math.random()<.5?-1*r:r,egret.Tween.get(a).to({x:r,y:n},500,egret.Ease.sineOut).call(function(){t.removeChild(a)})},s=this,r=0;4>r;r++)a(r)},e.prototype.share=function(){var t=this,e=egret.MainContext.instance.stage;this.s1=this.createBitmapByName("s1_png"),this.s1.width=59,this.s1.height=53.5,this.s1.x=e.stageWidth-this.s1.width,this.s1.y=e.stageHeight-330;var i=this.s1.y;this.addChild(this.s1),egret.Tween.get(this.s1,{loop:!0}).to({y:this.s1.y+10},1e3).to({y:i},1e3),this.s1.touchEnabled=!0,this.s1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){platform.share(t.removeRotateKunai(3))},this)},e.prototype.rebirth=function(){this.closeDialog(),this.resetKunai(),this.kunaiNum+=1,this.updateKunaiNum()},e.prototype.noChance=function(){var t=new Msg;this.addChild(t),t.init("一天只有三次复活机会哦")},e.prototype.masks=function(){var t=this.stage;this.timberMask=new TimberMask,this.timberMask.init(this.skin),this.addChild(this.timberMask),this.timberMask.x=t.stageWidth/2-this.timberMask.width/2,this.timberMask.y=130},e.GAME_END="gameend",e.GAME_RESTART="gamerestart",e}(egret.Sprite);__reflect(GamePlayingPanel.prototype,"GamePlayingPanel");var GameStartPanel=function(t){function e(){var e=t.call(this)||this;return e.isdisplay=!1,e.init(),e}return __extends(e,t),e.prototype.start=function(){var t=this,e=this,i=e.stage,n=e.startBtn,a=(e.onTouchTap,e.startPK),s=e.img,r=e.logo,o=(e.PK,e.bottom);s.width=i.stageWidth,s.height=i.stageHeight,r.x=i.stageWidth/2-r.width/2,r.y=-r.height,egret.Tween.get(r).to({y:60},500,egret.Ease.bounceOut),n.x=-n.width,n.y=400,n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.onTouchTap(1)},this),egret.Tween.get(n).to({x:i.stageWidth/2-n.width/2},500,egret.Ease.bounceOut),a.x=i.stageWidth,a.y=500,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.onTouchTap(2)},this),egret.Tween.get(a).to({x:i.stageWidth/2-a.width/2},500,egret.Ease.bounceOut),o.y=i.stageHeight,egret.Tween.get(o).to({y:i.stageHeight-o.height},500,egret.Ease.bounceOut)},e.prototype.init=function(){var t=this,e=egret.MainContext.instance.stage,i=new egret.Bitmap;i.texture=RES.getRes("1_jpg"),i.x=0,i.y=0,i.alpha=.6,this.img=i,this.addChildAt(this.img,0);var n=new egret.Bitmap;n.texture=RES.getRes("logo_png"),n.width=751*.4,n.height=599*.4,this.logo=n,this.addChild(this.logo),this.startBtn=new Buttons,this.addChild(this.startBtn),this.startBtn.init(1,"单人闯关"),this.startPK=new Buttons,this.addChild(this.startPK),this.startPK.init(4,"疯狂模式"),this.bottom=new Bottom,this.addChild(this.bottom),this.bottom.init(),this.bottom.addEventListener(Bottom.FRIENDS_RANK,this.friendsRank,this),this.bottom.addEventListener(Bottom.SKIN,this.showSkinDialog,this),this.btnClose=new egret.Bitmap(RES.getRes("close_png")),this.btnClose.width=25,this.btnClose.height=25,this.btnClose.x=4*e.stageWidth/5+30,this.btnClose.y=65,this.btnClose.touchEnabled=!0,this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.friendsRank(),t.removeChild(t.btnClose)},this)},e.prototype.onTouchTap=function(t){void 0===t&&(t=1),1===t?this.dispatchEventWith(e.GAME_START_1):2===t&&this.dispatchEventWith(e.GAME_START_2)},e.prototype.end=function(){var t=this,e=t.startBtn,i=t.onTouchTap;e.$touchEnabled=!1,e.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&e.removeEventListener(egret.TouchEvent.TOUCH_TAP,i,this)},e.prototype.friendsRank=function(){var t=window.platform;this.isdisplay?(this.bitmap.parent&&this.bitmap.parent.removeChild(this.bitmap),this.rankingListMask.parent&&this.rankingListMask.parent.removeChild(this.rankingListMask),this.isdisplay=!1,t.openDataContext.postMessage({isDisplay:this.isdisplay,text:"hello",year:(new Date).getFullYear(),command:"close"})):(this.rankingListMask=new egret.Shape,this.rankingListMask.graphics.beginFill(0,1),this.rankingListMask.graphics.drawRect(0,0,this.stage.width,this.stage.height),this.rankingListMask.graphics.endFill(),this.rankingListMask.alpha=.5,this.rankingListMask.touchEnabled=!0,this.addChild(this.rankingListMask),this.bitmap=t.openDataContext.createDisplayObject(null,this.stage.stageWidth,this.stage.stageHeight),this.addChild(this.bitmap),this.addChild(this.btnClose),t.openDataContext.postMessage({isDisplay:this.isdisplay,text:"hello",year:(new Date).getFullYear(),command:"open"}),this.isdisplay=!0)},e.prototype.showSkinDialog=function(){var t=egret.MainContext.instance.stage;this.skinMask=new egret.Shape,this.skinMask.graphics.beginFill(0,.2),this.skinMask.graphics.drawRoundRect(0,0,t.stageWidth,t.stageHeight,10),this.skinMask.graphics.endFill(),this.skinMask.touchEnabled=!0,this.addChild(this.skinMask),this.skinDialog=new SkinDialog,this.addChild(this.skinDialog),this.skinDialog.x=t.stageWidth/2-this.skinDialog._width/2,this.skinDialog.y=t.stageHeight/2-this.skinDialog._height/2,this.skinDialog.addEventListener(SkinDialog.CLOSE_SKIN,this.hideSkinDialog,this)},e.prototype.hideSkinDialog=function(){this.removeChild(this.skinMask),this.removeChild(this.skinDialog),this.skinDialog.removeEventListener(SkinDialog.CLOSE_SKIN,this.hideSkinDialog,this)},e.GAME_START_1="gamestart1",e.GAME_START_2="gamestart2",e}(egret.Sprite);__reflect(GameStartPanel.prototype,"GameStartPanel");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var a=RES.getRes(t);a?n(a):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();
__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var DebugPlatform=function(){function t(){}return t.prototype.scopeUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"悠悠丶",avatarUrl:"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKT3CKZgvyic14bBOYKpbaS2PvaS7t1ar4295xuV4w8xArEF8kuxWpzFicgADibw2c2XdWjasfzvDib5Q/132"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.setUserCloudStorage=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.removeUserCloudStorage=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.share=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,t&&t()]})})},t.prototype.setData=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return window.localStorage.setItem(t.key,t.value),[2,e&&e()]})})},t.prototype.getData=function(t,e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(n){return i=window.localStorage.getItem(t),[2,e?e(i):i]})})},t.prototype.removeData=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return window.localStorage.removeItem(t),[2,e&&e()]})})},t.prototype.clearData=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,t&&t()]})})},t.prototype.openMini=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function a(t){e.call(n,t)}function s(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(n))}var r=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(n,generateEUI2)},r)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var o=t.split("/");o.pop();var h=o.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(n,generateJSON.paths[t])},this):RES.getResByUrl(h,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(n,generateJSON.paths[t])},r)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(t,a,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Tools=function(){function t(){}return t.generateRandom=function(t,e){return Math.floor(Math.random()*(e-t)+t)},t}();__reflect(Tools.prototype,"Tools"),window.Main=Main;